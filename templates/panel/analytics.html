{% extends 'panel/base.html' %}
{% load static %}

{% block title %}Analytics - Panel Administrativo{% endblock %}

{% block extra_css %}
<style>
    .analytics-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
    }
    
    .page-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        border-radius: 15px;
        margin-bottom: 30px;
        text-align: center;
    }
    
    .page-header h1 {
        margin: 0 0 10px 0;
        font-size: 32px;
    }
    
    .page-header p {
        margin: 0;
        opacity: 0.9;
        font-size: 16px;
    }
    
    .analytics-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 25px;
        margin-bottom: 30px;
    }
    
    .chart-section {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    
    .metrics-sidebar {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }
    
    .metric-card {
        background: white;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        text-align: center;
        transition: transform 0.3s ease;
    }
    
    .metric-card:hover {
        transform: translateY(-3px);
    }
    
    .metric-icon {
        width: 50px;
        height: 50px;
        border-radius: 12px;
        margin: 0 auto 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        color: white;
    }
    
    .icon-revenue { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .icon-orders { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
    .icon-customers { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
    .icon-conversion { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
    .icon-growth { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
    .icon-retention { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
    
    .metric-value {
        font-size: 24px;
        font-weight: 600;
        color: #333;
        margin-bottom: 5px;
    }
    
    .metric-label {
        font-size: 12px;
        color: #6c757d;
        text-transform: uppercase;
        font-weight: 600;
        margin-bottom: 10px;
    }
    
    .metric-change {
        font-size: 12px;
        font-weight: 600;
        padding: 4px 8px;
        border-radius: 12px;
        display: inline-flex;
        align-items: center;
        gap: 4px;
    }
    
    .metric-change.positive {
        background: #d4edda;
        color: #155724;
    }
    
    .metric-change.negative {
        background: #f8d7da;
        color: #721c24;
    }
    
    .chart-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f8f9fa;
    }
    
    .chart-title {
        font-size: 18px;
        font-weight: 600;
        color: #333;
        margin: 0;
    }
    
    .chart-controls {
        display: flex;
        gap: 10px;
    }
    
    .btn {
        padding: 8px 16px;
        border: none;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .btn-primary {
        background: #667eea;
        color: white;
    }
    
    .btn-primary:hover {
        background: #5a6fd8;
    }
    
    .btn-secondary {
        background: #6c757d;
        color: white;
    }
    
    .btn-secondary:hover {
        background: #5a6268;
    }
    
    .btn-outline {
        background: transparent;
        border: 2px solid #e1e5e9;
        color: #6c757d;
    }
    
    .btn-outline:hover,
    .btn-outline.active {
        background: #667eea;
        border-color: #667eea;
        color: white;
    }
    
    .chart-container {
        height: 400px;
        position: relative;
        background: #f8f9fa;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 20px;
    }
    
    .chart-placeholder {
        text-align: center;
        color: #6c757d;
    }
    
    .chart-placeholder i {
        font-size: 48px;
        margin-bottom: 15px;
        opacity: 0.5;
    }
    
    .insights-section {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
    }
    
    .insights-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f8f9fa;
    }
    
    .insights-icon {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        color: white;
    }
    
    .insights-title {
        font-size: 18px;
        font-weight: 600;
        color: #333;
        margin: 0;
    }
    
    .insights-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
    }
    
    .insight-item {
        background: #f8f9fa;
        border-radius: 12px;
        padding: 20px;
        border-left: 4px solid #667eea;
    }
    
    .insight-title {
        font-weight: 600;
        color: #333;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .insight-description {
        color: #6c757d;
        font-size: 14px;
        line-height: 1.5;
        margin-bottom: 15px;
    }
    
    .insight-action {
        font-size: 12px;
        color: #667eea;
        font-weight: 600;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 5px;
    }
    
    .insight-action:hover {
        color: #5a6fd8;
    }
    
    .performance-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .performance-card {
        background: white;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    
    .performance-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 15px;
    }
    
    .performance-icon {
        width: 35px;
        height: 35px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        color: white;
    }
    
    .performance-title {
        font-size: 14px;
        font-weight: 600;
        color: #333;
        margin: 0;
    }
    
    .performance-chart {
        height: 120px;
        background: #f8f9fa;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 15px;
        position: relative;
        overflow: hidden;
    }
    
    .performance-stats {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .performance-value {
        font-size: 18px;
        font-weight: 600;
        color: #333;
    }
    
    .performance-trend {
        font-size: 12px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 4px;
    }
    
    .trend-up {
        color: #28a745;
    }
    
    .trend-down {
        color: #dc3545;
    }
    
    .filters-section {
        background: white;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
    }
    
    .filters-header {
        font-size: 16px;
        font-weight: 600;
        color: #333;
        margin-bottom: 15px;
    }
    
    .filters-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        align-items: end;
    }
    
    .filter-group {
        display: flex;
        flex-direction: column;
    }
    
    .filter-group label {
        font-size: 12px;
        font-weight: 600;
        color: #333;
        margin-bottom: 5px;
        text-transform: uppercase;
    }
    
    .filter-group select,
    .filter-group input {
        padding: 10px;
        border: 2px solid #e1e5e9;
        border-radius: 6px;
        font-size: 14px;
        transition: border-color 0.3s ease;
    }
    
    .filter-group select:focus,
    .filter-group input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    @media (max-width: 1200px) {
        .analytics-grid {
            grid-template-columns: 1fr;
        }
        
        .metrics-sidebar {
            flex-direction: row;
            overflow-x: auto;
            gap: 15px;
        }
        
        .metric-card {
            min-width: 150px;
        }
    }
    
    @media (max-width: 768px) {
        .chart-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 15px;
        }
        
        .chart-controls {
            width: 100%;
            justify-content: center;
        }
        
        .filters-grid {
            grid-template-columns: 1fr;
        }
        
        .performance-grid {
            grid-template-columns: 1fr;
        }
        
        .insights-grid {
            grid-template-columns: 1fr;
        }
        
        .metrics-sidebar {
            flex-direction: column;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="analytics-container">
    <div class="page-header">
        <h1><i class="fas fa-chart-area"></i> Analytics Dashboard</h1>
        <p>Análisis avanzado y métricas de rendimiento en tiempo real</p>
    </div>
    
    <!-- Filtros -->
    <div class="filters-section">
        <div class="filters-header">
            <i class="fas fa-filter"></i> Filtros de Análisis
        </div>
        <div class="filters-grid">
            <div class="filter-group">
                <label for="date_range">Rango de Fechas</label>
                <select id="date_range" onchange="updateAnalytics()">
                    <option value="7d">Últimos 7 días</option>
                    <option value="30d" selected>Últimos 30 días</option>
                    <option value="90d">Últimos 90 días</option>
                    <option value="1y">Último año</option>
                    <option value="custom">Personalizado</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="start_date">Fecha Inicio</label>
                <input type="date" id="start_date" onchange="updateAnalytics()">
            </div>
            <div class="filter-group">
                <label for="end_date">Fecha Fin</label>
                <input type="date" id="end_date" onchange="updateAnalytics()">
            </div>
            <div class="filter-group">
                <label for="category_filter">Categoría</label>
                <select id="category_filter" onchange="updateAnalytics()">
                    <option value="all">Todas las Categorías</option>
                    <option value="electronics">Electrónicos</option>
                    <option value="clothing">Ropa</option>
                    <option value="home">Hogar</option>
                    <option value="books">Libros</option>
                </select>
            </div>
            <div class="filter-group">
                <button class="btn btn-primary" onclick="applyFilters()">
                    <i class="fas fa-search"></i> Aplicar Filtros
                </button>
            </div>
        </div>
    </div>
    
    <!-- Métricas Principales y Gráfico -->
    <div class="analytics-grid">
        <div class="chart-section">
            <div class="chart-header">
                <h3 class="chart-title">Tendencia de Ventas</h3>
                <div class="chart-controls">
                    <button class="btn btn-outline active" onclick="changeChart('sales')">Ventas</button>
                    <button class="btn btn-outline" onclick="changeChart('orders')">Órdenes</button>
                    <button class="btn btn-outline" onclick="changeChart('customers')">Clientes</button>
                </div>
            </div>
            <div class="chart-container" id="mainChart">
                <div class="chart-placeholder">
                    <i class="fas fa-chart-line"></i>
                    <p>Gráfico de Tendencias</p>
                    <small>Los datos se cargarán aquí</small>
                </div>
            </div>
        </div>
        
        <div class="metrics-sidebar">
            <div class="metric-card">
                <div class="metric-icon icon-revenue">
                    <i class="fas fa-dollar-sign"></i>
                </div>
                <div class="metric-value">${{ total_revenue|default:"45,230" }}</div>
                <div class="metric-label">Ingresos Totales</div>
                <div class="metric-change positive">
                    <i class="fas fa-arrow-up"></i> +12.5%
                </div>
            </div>
            
            <div class="metric-card">
                <div class="metric-icon icon-orders">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <div class="metric-value">{{ total_orders|default:"1,234" }}</div>
                <div class="metric-label">Órdenes Totales</div>
                <div class="metric-change positive">
                    <i class="fas fa-arrow-up"></i> +8.3%
                </div>
            </div>
            
            <div class="metric-card">
                <div class="metric-icon icon-customers">
                    <i class="fas fa-users"></i>
                </div>
                <div class="metric-value">{{ new_customers|default:"89" }}</div>
                <div class="metric-label">Nuevos Clientes</div>
                <div class="metric-change positive">
                    <i class="fas fa-arrow-up"></i> +15.7%
                </div>
            </div>
            
            <div class="metric-card">
                <div class="metric-icon icon-conversion">
                    <i class="fas fa-percentage"></i>
                </div>
                <div class="metric-value">{{ conversion_rate|default:"3.2" }}%</div>
                <div class="metric-label">Tasa de Conversión</div>
                <div class="metric-change negative">
                    <i class="fas fa-arrow-down"></i> -2.1%
                </div>
            </div>
        </div>
    </div>
    
    <!-- Tarjetas de Rendimiento -->
    <div class="performance-grid">
        <div class="performance-card">
            <div class="performance-header">
                <div class="performance-icon icon-growth">
                    <i class="fas fa-chart-line"></i>
                </div>
                <h4 class="performance-title">Crecimiento de Ventas</h4>
            </div>
            <div class="performance-chart">
                <div class="chart-placeholder">
                    <i class="fas fa-chart-area"></i>
                </div>
            </div>
            <div class="performance-stats">
                <div class="performance-value">+18.5%</div>
                <div class="performance-trend trend-up">
                    <i class="fas fa-arrow-up"></i> vs mes anterior
                </div>
            </div>
        </div>
        
        <div class="performance-card">
            <div class="performance-header">
                <div class="performance-icon icon-retention">
                    <i class="fas fa-user-check"></i>
                </div>
                <h4 class="performance-title">Retención de Clientes</h4>
            </div>
            <div class="performance-chart">
                <div class="chart-placeholder">
                    <i class="fas fa-chart-pie"></i>
                </div>
            </div>
            <div class="performance-stats">
                <div class="performance-value">76.3%</div>
                <div class="performance-trend trend-up">
                    <i class="fas fa-arrow-up"></i> +3.2%
                </div>
            </div>
        </div>
        
        <div class="performance-card">
            <div class="performance-header">
                <div class="performance-icon icon-orders">
                    <i class="fas fa-box"></i>
                </div>
                <h4 class="performance-title">Valor Promedio de Orden</h4>
            </div>
            <div class="performance-chart">
                <div class="chart-placeholder">
                    <i class="fas fa-chart-bar"></i>
                </div>
            </div>
            <div class="performance-stats">
                <div class="performance-value">${{ avg_order_value|default:"127.50" }}</div>
                <div class="performance-trend trend-down">
                    <i class="fas fa-arrow-down"></i> -1.8%
                </div>
            </div>
        </div>
        
        <div class="performance-card">
            <div class="performance-header">
                <div class="performance-icon icon-customers">
                    <i class="fas fa-user-plus"></i>
                </div>
                <h4 class="performance-title">Adquisición de Clientes</h4>
            </div>
            <div class="performance-chart">
                <div class="chart-placeholder">
                    <i class="fas fa-chart-line"></i>
                </div>
            </div>
            <div class="performance-stats">
                <div class="performance-value">{{ customer_acquisition|default:"24" }}/día</div>
                <div class="performance-trend trend-up">
                    <i class="fas fa-arrow-up"></i> +9.1%
                </div>
            </div>
        </div>
    </div>
    
    <!-- Insights y Recomendaciones -->
    <div class="insights-section">
        <div class="insights-header">
            <div class="insights-icon">
                <i class="fas fa-lightbulb"></i>
            </div>
            <h3 class="insights-title">Insights y Recomendaciones</h3>
        </div>
        
        <div class="insights-grid">
            <div class="insight-item">
                <div class="insight-title">
                    <i class="fas fa-trending-up"></i>
                    Oportunidad de Crecimiento
                </div>
                <div class="insight-description">
                    Las ventas de productos electrónicos han aumentado un 25% este mes. Considera aumentar el inventario de esta categoría.
                </div>
                <a href="#" class="insight-action">
                    Ver productos electrónicos <i class="fas fa-arrow-right"></i>
                </a>
            </div>
            
            <div class="insight-item">
                <div class="insight-title">
                    <i class="fas fa-exclamation-triangle"></i>
                    Atención Requerida
                </div>
                <div class="insight-description">
                    La tasa de conversión ha disminuido un 2.1%. Revisa el proceso de checkout y las páginas de producto.
                </div>
                <a href="#" class="insight-action">
                    Analizar conversión <i class="fas fa-arrow-right"></i>
                </a>
            </div>
            
            <div class="insight-item">
                <div class="insight-title">
                    <i class="fas fa-star"></i>
                    Rendimiento Destacado
                </div>
                <div class="insight-description">
                    Los clientes nuevos han aumentado un 15.7%. Tu estrategia de marketing está funcionando bien.
                </div>
                <a href="#" class="insight-action">
                    Ver campañas activas <i class="fas fa-arrow-right"></i>
                </a>
            </div>
            
            <div class="insight-item">
                <div class="insight-title">
                    <i class="fas fa-clock"></i>
                    Tendencia Temporal
                </div>
                <div class="insight-description">
                    Las ventas son más altas los fines de semana. Considera promociones especiales para días de semana.
                </div>
                <a href="#" class="insight-action">
                    Crear promoción <i class="fas fa-arrow-right"></i>
                </a>
            </div>
        </div>
    </div>
    
    <!-- Gráficos Adicionales -->
    <div class="analytics-grid">
        <div class="chart-section">
            <div class="chart-header">
                <h3 class="chart-title">Análisis de Productos</h3>
                <div class="chart-controls">
                    <button class="btn btn-outline active" onclick="changeProductChart('top_selling')">Más Vendidos</button>
                    <button class="btn btn-outline" onclick="changeProductChart('revenue')">Por Ingresos</button>
                    <button class="btn btn-outline" onclick="changeProductChart('margin')">Por Margen</button>
                </div>
            </div>
            <div class="chart-container" id="productChart">
                <div class="chart-placeholder">
                    <i class="fas fa-chart-bar"></i>
                    <p>Análisis de Productos</p>
                    <small>Top 10 productos por categoría seleccionada</small>
                </div>
            </div>
        </div>
        
        <div class="chart-section">
            <div class="chart-header">
                <h3 class="chart-title">Distribución Geográfica</h3>
                <div class="chart-controls">
                    <button class="btn btn-outline active" onclick="changeGeoChart('sales')">Ventas</button>
                    <button class="btn btn-outline" onclick="changeGeoChart('customers')">Clientes</button>
                </div>
            </div>
            <div class="chart-container" id="geoChart">
                <div class="chart-placeholder">
                    <i class="fas fa-map-marked-alt"></i>
                    <p>Mapa de Ventas</p>
                    <small>Distribución por región</small>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Variables globales
    let currentChart = 'sales';
    let currentProductChart = 'top_selling';
    let currentGeoChart = 'sales';
    
    // Inicializar fechas por defecto
    document.addEventListener('DOMContentLoaded', function() {
        const today = new Date();
        const thirtyDaysAgo = new Date(today.getTime() - (30 * 24 * 60 * 60 * 1000));
        
        document.getElementById('start_date').value = thirtyDaysAgo.toISOString().split('T')[0];
        document.getElementById('end_date').value = today.toISOString().split('T')[0];
        
        // Simular carga inicial de datos
        setTimeout(() => {
            loadAnalyticsData();
        }, 1000);
    });
    
    // Función para cambiar el gráfico principal
    function changeChart(type) {
        currentChart = type;
        
        // Actualizar botones activos
        document.querySelectorAll('.chart-controls .btn-outline').forEach(btn => {
            btn.classList.remove('active');
        });
        event.target.classList.add('active');
        
        // Simular carga de datos
        showChartLoading('mainChart');
        setTimeout(() => {
            loadChartData(type);
        }, 800);
    }
    
    // Función para cambiar el gráfico de productos
    function changeProductChart(type) {
        currentProductChart = type;
        
        // Actualizar botones activos
        const productControls = document.querySelector('#productChart').parentElement.querySelector('.chart-controls');
        productControls.querySelectorAll('.btn-outline').forEach(btn => {
            btn.classList.remove('active');
        });
        event.target.classList.add('active');
        
        // Simular carga de datos
        showChartLoading('productChart');
        setTimeout(() => {
            loadProductChartData(type);
        }, 800);
    }
    
    // Función para cambiar el gráfico geográfico
    function changeGeoChart(type) {
        currentGeoChart = type;
        
        // Actualizar botones activos
        const geoControls = document.querySelector('#geoChart').parentElement.querySelector('.chart-controls');
        geoControls.querySelectorAll('.btn-outline').forEach(btn => {
            btn.classList.remove('active');
        });
        event.target.classList.add('active');
        
        // Simular carga de datos
        showChartLoading('geoChart');
        setTimeout(() => {
            loadGeoChartData(type);
        }, 800);
    }
    
    // Función para mostrar loading en gráficos
    function showChartLoading(chartId) {
        const chart = document.getElementById(chartId);
        chart.innerHTML = `
            <div class="chart-placeholder">
                <i class="fas fa-spinner fa-spin fa-2x"></i>
                <p>Cargando datos...</p>
            </div>
        `;
    }
    
    // Función para cargar datos del gráfico principal
    function loadChartData(type) {
        const chart = document.getElementById('mainChart');
        let title, icon;
        
        switch(type) {
            case 'sales':
                title = 'Tendencia de Ventas';
                icon = 'fa-chart-line';
                break;
            case 'orders':
                title = 'Tendencia de Órdenes';
                icon = 'fa-shopping-cart';
                break;
            case 'customers':
                title = 'Nuevos Clientes';
                icon = 'fa-users';
                break;
        }
        
        chart.innerHTML = `
            <div class="chart-placeholder">
                <i class="fas ${icon}"></i>
                <p>${title}</p>
                <small>Datos actualizados para el período seleccionado</small>
            </div>
        `;
    }
    
    // Función para cargar datos del gráfico de productos
    function loadProductChartData(type) {
        const chart = document.getElementById('productChart');
        let title;
        
        switch(type) {
            case 'top_selling':
                title = 'Productos Más Vendidos';
                break;
            case 'revenue':
                title = 'Productos por Ingresos';
                break;
            case 'margin':
                title = 'Productos por Margen';
                break;
        }
        
        chart.innerHTML = `
            <div class="chart-placeholder">
                <i class="fas fa-chart-bar"></i>
                <p>${title}</p>
                <small>Top 10 productos</small>
            </div>
        `;
    }
    
    // Función para cargar datos del gráfico geográfico
    function loadGeoChartData(type) {
        const chart = document.getElementById('geoChart');
        let title;
        
        switch(type) {
            case 'sales':
                title = 'Ventas por Región';
                break;
            case 'customers':
                title = 'Clientes por Región';
                break;
        }
        
        chart.innerHTML = `
            <div class="chart-placeholder">
                <i class="fas fa-map-marked-alt"></i>
                <p>${title}</p>
                <small>Distribución geográfica</small>
            </div>
        `;
    }
    
    // Función para actualizar analytics cuando cambian los filtros
    function updateAnalytics() {
        const dateRange = document.getElementById('date_range').value;
        
        if (dateRange === 'custom') {
            document.getElementById('start_date').style.display = 'block';
            document.getElementById('end_date').style.display = 'block';
        } else {
            document.getElementById('start_date').style.display = 'none';
            document.getElementById('end_date').style.display = 'none';
            
            // Establecer fechas automáticamente
            const today = new Date();
            let startDate;
            
            switch(dateRange) {
                case '7d':
                    startDate = new Date(today.getTime() - (7 * 24 * 60 * 60 * 1000));
                    break;
                case '30d':
                    startDate = new Date(today.getTime() - (30 * 24 * 60 * 60 * 1000));
                    break;
                case '90d':
                    startDate = new Date(today.getTime() - (90 * 24 * 60 * 60 * 1000));
                    break;
                case '1y':
                    startDate = new Date(today.getTime() - (365 * 24 * 60 * 60 * 1000));
                    break;
            }
            
            document.getElementById('start_date').value = startDate.toISOString().split('T')[0];
            document.getElementById('end_date').value = today.toISOString().split('T')[0];
        }
    }
    
    // Función para aplicar filtros
    function applyFilters() {
        showLoading();
        
        setTimeout(() => {
            hideLoading();
            loadAnalyticsData();
            showSuccessMessage('Filtros aplicados correctamente');
        }, 1500);
    }
    
    // Función para cargar todos los datos de analytics
    function loadAnalyticsData() {
        // Simular carga de todos los gráficos
        loadChartData(currentChart);
        loadProductChartData(currentProductChart);
        loadGeoChartData(currentGeoChart);
        
        // Actualizar métricas (en una implementación real, esto vendría del servidor)
        updateMetrics();
    }
    
    // Función para actualizar métricas
    function updateMetrics() {
        // Simular actualización de métricas con datos aleatorios
        const metrics = {
            revenue: Math.floor(Math.random() * 50000) + 30000,
            orders: Math.floor(Math.random() * 1000) + 800,
            customers: Math.floor(Math.random() * 100) + 50,
            conversion: (Math.random() * 2 + 2).toFixed(1)
        };
        
        // Actualizar valores en la interfaz
        document.querySelector('.icon-revenue').parentElement.querySelector('.metric-value').textContent = `$${metrics.revenue.toLocaleString()}`;
        document.querySelector('.icon-orders').parentElement.querySelector('.metric-value').textContent = metrics.orders.toLocaleString();
        document.querySelector('.icon-customers').parentElement.querySelector('.metric-value').textContent = metrics.customers;
        document.querySelector('.icon-conversion').parentElement.querySelector('.metric-value').textContent = `${metrics.conversion}%`;
    }
    
    // Función para mostrar loading general
    function showLoading() {
        // Crear overlay de loading
        const overlay = document.createElement('div');
        overlay.id = 'loadingOverlay';
        overlay.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        `;
        overlay.innerHTML = `
            <div style="text-align: center; color: #667eea;">
                <i class="fas fa-spinner fa-spin fa-3x"></i>
                <p style="margin-top: 15px; font-size: 16px; font-weight: 600;">Actualizando analytics...</p>
            </div>
        `;
        
        document.body.appendChild(overlay);
    }
    
    // Función para ocultar loading general
    function hideLoading() {
        const overlay = document.getElementById('loadingOverlay');
        if (overlay) {
            overlay.remove();
        }
    }
    
    // Función para mostrar mensaje de éxito
    function showSuccessMessage(message) {
        const alert = document.createElement('div');
        alert.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: #d4edda;
            color: #155724;
            padding: 15px 20px;
            border-radius: 8px;
            border: 1px solid #c3e6cb;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        `;
        alert.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
        
        document.body.appendChild(alert);
        
        setTimeout(() => {
            alert.remove();
        }, 3000);
    }
    
    // Auto-refresh cada 5 minutos
    setInterval(() => {
        loadAnalyticsData();
    }, 300000);
</script>
{% endblock %}