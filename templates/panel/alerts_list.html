{% extends 'panel/base.html' %}

{% block title %}Alertas ‚Äî Panel O11CE{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">Centro de Alertas</h1>
    <p class="page-subtitle">Notificaciones y alertas del sistema</p>
</div>

<div class="card">
    <div class="card-header">
        <h2 class="card-title">üîî Alertas recientes</h2>
    </div>
    <div class="card-body">
        {% if alerts %}
        <div class="alerts-list">
            {% for alert in alerts %}
            <div class="alert-item {% if not alert.is_read %}alert-unread{% endif %}">
                <div class="alert-icon">
                    {% if alert.type == 'low_stock' %}
                        üì¶
                    {% elif alert.type == 'near_expiry' %}
                        ‚ö†Ô∏è
                    {% elif alert.type == 'new_order' %}
                        üìã
                    {% elif alert.type == 'system' %}
                        ‚öôÔ∏è
                    {% else %}
                        üîî
                    {% endif %}
                </div>
                <div class="alert-content">
                    <div class="alert-header">
                        <h4 class="alert-title">{{ alert.title|default:"Notificaci√≥n" }}</h4>
                        <span class="alert-time">{{ alert.created_at|timesince }} atr√°s</span>
                    </div>
                    <p class="alert-message">{{ alert.message }}</p>
                    {% if alert.type %}
                        <div class="alert-meta">
                            <span class="alert-type-badge alert-type-{{ alert.type }}">
                                {% if alert.type == 'low_stock' %}
                                    Stock bajo
                                {% elif alert.type == 'near_expiry' %}
                                    Pr√≥ximo a vencer
                                {% elif alert.type == 'new_order' %}
                                    Nuevo pedido
                                {% elif alert.type == 'system' %}
                                    Sistema
                                {% else %}
                                    {{ alert.type|title }}
                                {% endif %}
                            </span>
                        </div>
                    {% endif %}
                </div>
                <div class="alert-actions">
                    {% if not alert.is_read %}
                        <button class="btn btn-sm btn-secondary mark-read" data-alert-id="{{ alert.id }}">Marcar como le√≠da</button>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        
        <div class="alerts-summary">
            <div class="summary-stats">
                <div class="stat-item">
                    <span class="stat-label">Total de alertas:</span>
                    <span class="stat-value">{{ alerts|length }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">No le√≠das:</span>
                    <span class="stat-value text-warning">
                        {% for alert in alerts %}{% if not alert.is_read %}{{ forloop.counter0|add:1 }}{% endif %}{% empty %}0{% endfor %}
                    </span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Stock bajo:</span>
                    <span class="stat-value text-danger">
                        {% for alert in alerts %}{% if alert.type == 'low_stock' %}{{ forloop.counter0|add:1 }}{% endif %}{% empty %}0{% endfor %}
                    </span>
                </div>
            </div>
        </div>
        
        {% else %}
        <div class="empty-state">
            <div class="empty-icon">üîî</div>
            <h3>No hay alertas</h3>
            <p>No se han generado alertas en el sistema.</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .alerts-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }
    
    .alert-item {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        padding: 1.5rem;
        background: #f8f9fa;
        border-radius: 8px;
        border-left: 4px solid #e9ecef;
        transition: all 0.2s;
    }
    
    .alert-item:hover {
        background: #e9ecef;
    }
    
    .alert-unread {
        background: #fff3cd;
        border-left-color: #ffc107;
    }
    
    .alert-unread:hover {
        background: #ffeaa7;
    }
    
    .alert-icon {
        font-size: 1.5rem;
        flex-shrink: 0;
        margin-top: 0.25rem;
    }
    
    .alert-content {
        flex: 1;
        min-width: 0;
    }
    
    .alert-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 0.5rem;
        gap: 1rem;
    }
    
    .alert-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin: 0;
        color: #2c3e50;
    }
    
    .alert-time {
        font-size: 0.85rem;
        color: #6c757d;
        white-space: nowrap;
    }
    
    .alert-message {
        margin: 0 0 1rem 0;
        color: #495057;
        line-height: 1.5;
    }
    
    .alert-meta {
        display: flex;
        gap: 0.5rem;
        align-items: center;
    }
    
    .alert-type-badge {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        font-size: 0.75rem;
        font-weight: 500;
        border-radius: 0.375rem;
        text-transform: uppercase;
        letter-spacing: 0.025em;
    }
    
    .alert-type-low_stock {
        background-color: #dc3545;
        color: white;
    }
    
    .alert-type-near_expiry {
        background-color: #ffc107;
        color: #212529;
    }
    
    .alert-type-new_order {
        background-color: #007bff;
        color: white;
    }
    
    .alert-type-system {
        background-color: #6c757d;
        color: white;
    }
    
    .alert-actions {
        flex-shrink: 0;
    }
    
    .btn-sm {
        padding: 0.25rem 0.5rem;
        font-size: 0.8rem;
    }
    
    .text-warning {
        color: #ffc107;
    }
    
    .text-danger {
        color: #dc3545;
    }
    
    .alerts-summary {
        margin-top: 2rem;
        padding-top: 1.5rem;
        border-top: 1px solid #e9ecef;
    }
    
    .summary-stats {
        display: flex;
        gap: 2rem;
        flex-wrap: wrap;
    }
    
    .stat-item {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }
    
    .stat-label {
        font-size: 0.9rem;
        color: #6c757d;
        font-weight: 500;
    }
    
    .stat-value {
        font-size: 1.25rem;
        font-weight: 600;
    }
    
    .empty-state {
        text-align: center;
        padding: 3rem 1rem;
    }
    
    .empty-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
    }
    
    .empty-state h3 {
        color: #495057;
        margin-bottom: 0.5rem;
    }
    
    .empty-state p {
        color: #6c757d;
    }
    
    @media (max-width: 768px) {
        .alert-item {
            flex-direction: column;
            gap: 1rem;
        }
        
        .alert-header {
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .summary-stats {
            flex-direction: column;
            gap: 1rem;
        }
    }
</style>
{% endblock %}

{% block scripts %}
<script>
    // Funcionalidad para marcar alertas como le√≠das
    document.addEventListener('DOMContentLoaded', function() {
        const markReadButtons = document.querySelectorAll('.mark-read');
        
        markReadButtons.forEach(button => {
            button.addEventListener('click', function() {
                const alertId = this.getAttribute('data-alert-id');
                
                // Aqu√≠ podr√≠as hacer una llamada AJAX para marcar como le√≠da
                // Por ahora, solo ocultamos el bot√≥n y cambiamos el estilo
                const alertItem = this.closest('.alert-item');
                alertItem.classList.remove('alert-unread');
                this.style.display = 'none';
                
                // Opcional: hacer la llamada AJAX
                // fetch(`/api/alerts/${alertId}/mark-read/`, { method: 'POST' });
            });
        });
    });
</script>
{% endblock %}